{{ define "main" }}
<section class="container">
  <h1>{{ .Title }}</h1>

  {{/* Helper partial-like function to render a group with optional abstract */}}
  {{- $renderGroup := func (papers showAbstract bool) -}}
    {{ range $papers }}
      <div class="pub-item">
        <h4>{{ .Title }}</h4>
        {{ with .Params.authors }}
          <p><em>{{ delimit . ", " }}</em></p>
        {{ end }}
        {{ if $showAbstract }}
          {{ with .Params.abstract }}
            <p><strong>Abstract:</strong> {{ . }}</p>
          {{ end }}
        {{ end }}
          {{ with .Params.presentations }}
            <p><strong>Presentations:</strong> {{ delimit . ", " }}</p>
        {{ end }}
        {{ with .Params.links }}
          {{ range . }}
            <a class="btn btn-sm btn-outline-primary" href="{{ .url }}">{{ .name }}</a>
          {{ end }}
        {{ end }}
        <br>
      </div>
    {{ end }}
  {{- end }}
  
  {{/* PUBLICATIONS: no abstract */}}
  {{ $pubs := where .Pages "Params.publication_types" "intersect" (slice "2") }}
  {{ if gt (len $pubs) 0 }}
    <h2 class="text-success mt-4">Publications</h2>
    {{ $renderGroup $pubs false }}
  {{ end }}
  
  {{/* JOB MARKET PAPER: show abstract */}}
  {{ $jmp := where .Pages "Params.publication_types" "intersect" (slice "1") }}
  {{ if gt (len $jmp) 0 }}
    <h2 class="text-primary mt-4">Job Market Paper</h2>
    {{ $renderGroup $jmp true }}
  {{ end }}

  {{/* WORKING PAPERS: show abstract */}}
  {{ $wps := where .Pages "Params.publication_types" "intersect" (slice "3") }}
  {{ if gt (len $wps) 0 }}
    <h2 class="text-danger mt-4">Working Papers</h2>
    {{ $renderGroup $wps true }}
  {{ end }}

  {{/* WORK IN PROGRESS: no abstract */}}
  {{ $wip := where .Pages "Params.publication_types" "intersect" (slice "4") }}
  {{ if gt (len $wip) 0 }}
    <h2 class="text-muted mt-4">Work in Progress</h2>
    {{ $renderGroup $wip false }}
  {{ end }}


</section>
{{ end }}
